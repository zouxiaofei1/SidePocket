<Window x:Class="SidePocket.SideBallWindow"
        x:Name="ThisWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        Topmost="True" ShowInTaskbar="False"
        Width="32" Height="32" ResizeMode="NoResize"
        MouseDoubleClick="Window_MouseDoubleClick">
    
        <Border x:Name="MainBorder" CornerRadius="16" Background="{DynamicResource CardBackgroundBrush}" BorderBrush="{DynamicResource BorderBrush}" 
            BorderThickness="1.5"
            RenderTransformOrigin="0.5,0.5">
        <Border.RenderTransform>
            <TransformGroup>
                <ScaleTransform x:Name="MainScale" ScaleX="1" ScaleY="1"/>
                <RotateTransform x:Name="MainRotate" Angle="0"/>
            </TransformGroup>
        </Border.RenderTransform>
        <Border.Effect>
            <DropShadowEffect x:Name="MainShadow" BlurRadius="10" ShadowDepth="0" Color="#0078D4" Opacity="0.3"/>
        </Border.Effect>
        <Grid>
            <!-- 扩散圆圈反馈 -->
            <Ellipse x:Name="RippleEllipse" Width="32" Height="32" IsHitTestVisible="False" Opacity="0">
                <Ellipse.Stroke>
                    <RadialGradientBrush>
                        <GradientStop Color="#00B7F0" Offset="0.8"/>
                        <GradientStop Color="Transparent" Offset="1"/>
                    </RadialGradientBrush>
                </Ellipse.Stroke>
                <Ellipse.StrokeThickness>2</Ellipse.StrokeThickness>
                <Ellipse.RenderTransform>
                    <ScaleTransform x:Name="RippleScale" CenterX="16" CenterY="16" ScaleX="1" ScaleY="1"/>
                </Ellipse.RenderTransform>
            </Ellipse>

            <!-- 第二层逆向流光背景 -->
            <Ellipse x:Name="StreamGlowBack" Margin="-3">
                <Ellipse.Fill>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#7B5EFF" Offset="0.0"/>
                        <GradientStop Color="Transparent" Offset="0.5"/>
                        <GradientStop Color="#7B5EFF" Offset="1.0"/>
                    </LinearGradientBrush>
                </Ellipse.Fill>
                <Ellipse.RenderTransform>
                    <RotateTransform x:Name="StreamRotateBack" Angle="0" CenterX="19" CenterY="19"/>
                </Ellipse.RenderTransform>
                <Ellipse.OpacityMask>
                    <RadialGradientBrush>
                        <GradientStop Color="Black" Offset="0.5"/>
                        <GradientStop Color="Transparent" Offset="1"/>
                    </RadialGradientBrush>
                </Ellipse.OpacityMask>
            </Ellipse>

            <!-- 流光背景 -->
            <Ellipse x:Name="StreamGlow" Margin="-2">
                <Ellipse.Fill>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#0078D4" Offset="0.0"/>
                        <GradientStop Color="#00B7F0" Offset="0.5"/>
                        <GradientStop Color="#0078D4" Offset="1.0"/>
                    </LinearGradientBrush>
                </Ellipse.Fill>
                <Ellipse.RenderTransform>
                    <RotateTransform x:Name="StreamRotate" Angle="0" CenterX="17" CenterY="17"/>
                </Ellipse.RenderTransform>
                <Ellipse.OpacityMask>
                    <RadialGradientBrush>
                        <GradientStop Color="Black" Offset="0.8"/>
                        <GradientStop Color="Transparent" Offset="1"/>
                    </RadialGradientBrush>
                </Ellipse.OpacityMask>
            </Ellipse>

            <!-- 内部毛玻璃感 -->
            <Ellipse Margin="1" Fill="{DynamicResource FluentGlassBrush}" Opacity="0.8"/>

            <!-- 呼吸发光背景 -->
            <Ellipse x:Name="GlowEllipse" Margin="-4" Opacity="0">
                <Ellipse.Fill>
                    <RadialGradientBrush>
                        <GradientStop Color="#660078D4" Offset="0"/>
                        <GradientStop Color="#000078D4" Offset="1"/>
                    </RadialGradientBrush>
                </Ellipse.Fill>
            </Ellipse>

            <Image Name="AppIcon" Width="20" Height="20" HorizontalAlignment="Center" VerticalAlignment="Center" RenderOptions.BitmapScalingMode="HighQuality">
                <Image.Effect>
                    <DropShadowEffect BlurRadius="4" ShadowDepth="1" Opacity="0.2"/>
                </Image.Effect>
            </Image>
        </Grid>
    </Border>

    <Window.Resources>
        <Storyboard x:Key="RippleStoryboard">
            <DoubleAnimation Storyboard.TargetName="RippleEllipse" Storyboard.TargetProperty="Opacity" From="1" To="0" Duration="0:0:0.8"/>
            <DoubleAnimation Storyboard.TargetName="RippleScale" Storyboard.TargetProperty="ScaleX" From="1" To="4" Duration="0:0:0.8">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="RippleScale" Storyboard.TargetProperty="ScaleY" From="1" To="4" Duration="0:0:0.8">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="ExitStoryboard">
            <DoubleAnimation Storyboard.TargetName="ThisWindow" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetName="MainScale" Storyboard.TargetProperty="ScaleX" To="0" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <BackEase Amplitude="1" EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="MainScale" Storyboard.TargetProperty="ScaleY" To="0" Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <BackEase Amplitude="1" EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </Window.Resources>

    <Window.Triggers>
        <EventTrigger RoutedEvent="Window.Loaded">
            <BeginStoryboard x:Name="LoadStoryboard">
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="MainScale" Storyboard.TargetProperty="ScaleX" From="0" To="1" Duration="0:0:0.5">
                        <DoubleAnimation.EasingFunction>
                            <ElasticEase Oscillations="1" Springiness="6" EasingMode="EaseOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                    <DoubleAnimation Storyboard.TargetName="MainScale" Storyboard.TargetProperty="ScaleY" From="0" To="1" Duration="0:0:0.5">
                        <DoubleAnimation.EasingFunction>
                            <ElasticEase Oscillations="1" Springiness="6" EasingMode="EaseOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                    <DoubleAnimation Storyboard.TargetName="MainRotate" Storyboard.TargetProperty="Angle" From="-45" To="0" Duration="0:0:0.5">
                        <DoubleAnimation.EasingFunction>
                            <PowerEase Power="4" EasingMode="EaseOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"/>
                    
                    <!-- 持续呼吸效果 -->
                    <DoubleAnimation Storyboard.TargetName="GlowEllipse" Storyboard.TargetProperty="Opacity" From="0.2" To="0.6" Duration="0:0:1.5" AutoReverse="True" RepeatBehavior="Forever"/>
                    <DoubleAnimation Storyboard.TargetName="MainShadow" Storyboard.TargetProperty="BlurRadius" From="8" To="15" Duration="0:0:1.5" AutoReverse="True" RepeatBehavior="Forever"/>
                    
                    <!-- 旋转光效动画 -->
                    <DoubleAnimation Storyboard.TargetName="StreamRotate" Storyboard.TargetProperty="Angle" From="0" To="360" Duration="0:0:4" RepeatBehavior="Forever"/>
                    <DoubleAnimation Storyboard.TargetName="StreamRotateBack" Storyboard.TargetProperty="Angle" From="360" To="0" Duration="0:0:3" RepeatBehavior="Forever"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
        <EventTrigger RoutedEvent="MouseEnter" SourceName="MainBorder">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="MainScale" Storyboard.TargetProperty="ScaleX" To="1.2" Duration="0:0:0.2">
                        <DoubleAnimation.EasingFunction>
                            <CubicEase EasingMode="EaseOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                    <DoubleAnimation Storyboard.TargetName="MainScale" Storyboard.TargetProperty="ScaleY" To="1.2" Duration="0:0:0.2">
                        <DoubleAnimation.EasingFunction>
                            <CubicEase EasingMode="EaseOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                    <DoubleAnimation Storyboard.TargetName="MainShadow" Storyboard.TargetProperty="Opacity" To="0.8" Duration="0:0:0.2"/>
                    <ColorAnimation Storyboard.TargetName="MainShadow" Storyboard.TargetProperty="Color" To="#00B7F0" Duration="0:0:0.2"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
        <EventTrigger RoutedEvent="MouseLeave" SourceName="MainBorder">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="MainScale" Storyboard.TargetProperty="ScaleX" To="1.0" Duration="0:0:0.2"/>
                    <DoubleAnimation Storyboard.TargetName="MainScale" Storyboard.TargetProperty="ScaleY" To="1.0" Duration="0:0:0.2"/>
                    <DoubleAnimation Storyboard.TargetName="MainShadow" Storyboard.TargetProperty="Opacity" To="0.3" Duration="0:0:0.2"/>
                    <ColorAnimation Storyboard.TargetName="MainShadow" Storyboard.TargetProperty="Color" To="#0078D4" Duration="0:0:0.2"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </Window.Triggers>
</Window>
